# Сервис Supplies App

**Supplies App** — это сервис для автоматизации управления поставками на Wildberries. Он включает в себя скрипт-демон для мониторинга и планирования поставок, интеграцию с Selenium для взаимодействия с интерфейсом Wildberries, а также поддержку API и Pub/Sub для асинхронной обработки. Сервис работает с несколькими юридическими лицами, используя прокси и кэширование сессий.

## Функциональные возможности

- **Мониторинг поставок**: Сбор данных о незапланированных поставках и автоматическое планирование с учетом коэффициентов и дат.
- **Авторизация**: Поддержка авторизации через куки/локальное хранилище или номер телефона с кодом подтверждения.
- **Критерии выбора**: Фильтрация поставок по дате и коэффициенту через настраиваемые критерии.
- **Прокси**: Использование прокси для каждого юридического лица с динамической генерацией расширений Chrome.
- **Хранение данных**: Сохранение информации о поставках в базе данных (SQLAlchemy) и публикация событий в Google Cloud Pub/Sub.
- **Многопроцессорность**: Параллельная обработка юридических лиц через `multiprocessing`.
- **Логирование**: Подробное логирование с сохранением в файл.

## Начало работы

Для запуска сервиса необходимо настроить окружение, установить зависимости и запустить демон или утилиты.

### Настройка локально

1. **Создание виртуального окружения**:
   Создайте виртуальное окружение с помощью Poetry:
   ```bash
   poetry env use python3.12
   ```
   
    - Активируйте его:
   ```
   poetry shell
   ```

2. **Установка зависимостей: Установите зависимости через Poetry:**
    ```
   poetry install
   ```
   
3. **Настройка переменных окружения: Скопируйте файл .env-example в .env:**
    ```
   cp .env-example .env
   ```
   
**Укажите в .env:**
- GMAIL_SCOPES
- URL_ACCESS_GOOGLE
- GOOGLE_SECRETS_INFO
- PROJECT_ROOT
- PROJECT_ID
- LOG_TOPIC
- SERVICE_NAME
- TOPIC_ID
- LEGAL_ENTITIES_PROXIES
- GOOD_COEFFICIENTS
- DRIVER_VERSION
- FILTERED_DATE
- TEST

4. **Генерация расширений прокси: Запустите утилиту для создания расширений Chrome для прокси:**
    ```
   poetry run python -m src.utils.create_proxy
   ```
   
5. **Локальный запуск демона: Запустите основной скрипт для мониторинга поставок:**
    ```
   poetry run python main.py
   ```


## Дополнительная информация
- WildberriesClient: Использует undetected-chromedriver для обхода защиты и взаимодействия с интерфейсом Wildberries.


- Авторизация: Поддерживает восстановление сессий через куки и локальное хранилище или вход по номеру телефона.


- Критерии: Реализованы DateCriteria и CoefficientCriteria для фильтрации поставок.


- Pub/Sub: Публикация событий о поставках в Google Cloud Pub/Sub с механизмом повторов.


- Многопроцессорность: Каждый юрлицо обрабатывается в отдельном процессе через multiprocessing.
