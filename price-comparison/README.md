# Сервис Price Comparison

Сервис **Price Comparison** предназначен для сравнения цен на товары между маркетплейсами *Wildberries* и *Ozon*. Он собирает данные о ценах, скидках, остатках, продажах и акциях, сопоставляет товары по внутренним идентификаторам и предоставляет информацию для анализа конкурентоспособности цен.

## Функциональные возможности

- **Сравнение цен**: Сбор и сопоставление цен, скидок и минимальных цен товаров на Wildberries и Ozon.
- **Анализ остатков**: Получение данных об остатках товаров на складах (FBO и FBS).
- **Учет продаж**: Сбор статистики продаж за последние 30 дней.
- **Информация об акциях**: Отслеживание акций и рекламных кампаний на Ozon.
- **Сопоставление товаров**: Группировка товаров по внутренним идентификаторам для сравнения между маркетплейсами.
- **Работа с MongoDB**: Использование MongoDB для хранения и обработки данных о товарах, заказах и поставках.

## Начало работы

Вы можете запустить сервис локально или с использованием Docker. Следуйте приведенным ниже инструкциям для начала работы.

### Запуск локально

1. **Копирование и настройка переменных окружения**:
   - Скопируйте файл окружения-примера `.env-example` в `.env`:
   ```bash
   cp .env-example .env
   ```
   
   - Замените переменные в файле .env на ваши собственные данные (настройки MongoDB, Google Cloud и т.д.).

2. **Установка зависимостей:**
    - Установите зависимости проекта с флагом для разработки:
   ```
   poetry install --with dev
   ```
   
3. **Запуск сервиса:**
    - Запустите основной файл сервиса:
   ```
   python3 systemd/price_comparison.py
   ```
   
## Запуск с использованием Docker

1. **Копирование и настройка переменных окружения:**
   - Скопируйте файл окружения-примера .env-example в .env-non-dev:
   ```
   cp .env-example .env-non-dev
   ```

   - Замените переменные в файле .env-non-dev на ваши собственные данные.

2. **Запуск сервиса с использованием Docker:**
   - Соберите и запустите Docker-контейнеры:
   ```
   docker-compose up --build -d
   ```
   
## Дополнительная информация

- Сервис использует MongoDB для хранения данных о товарах, заказах, поставках и акциях. Убедитесь, что переменные окружения для подключения к MongoDB настроены корректно (MONGO_HOST, MONGO_PORT, MONGO_USER, MONGO_PASS, MONGO_DB).


- Для авторизации в Google Cloud (например, для работы с Google Sheets) настройте переменную GOOGLE_APPLICATION_CREDENTIALS с путем к файлу учетных данных.


- Поддерживаются маркетплейсы Wildberries и Ozon. Данные собираются асинхронно с использованием asyncio и обрабатываются в многопроцессорном режиме через ProcessPoolExecutor.


- Сервис интегрирован с SQLAlchemy и asyncpg для работы с базой данных PostgreSQL (если требуется).